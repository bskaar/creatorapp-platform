<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stripe Price Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">Stripe Price Checker</h1>

    <div class="bg-white p-6 rounded-lg shadow mb-6">
      <h2 class="text-xl font-bold mb-4">Enter Your Stripe Secret Key</h2>
      <p class="text-sm text-gray-600 mb-4">This will check if your Price IDs are properly configured for subscriptions</p>

      <input
        type="password"
        id="stripeKey"
        placeholder="sk_test_..."
        class="w-full border rounded px-4 py-2 mb-4"
      >

      <button
        id="checkBtn"
        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
      >
        Check Price Configuration
      </button>
    </div>

    <div id="results" class="space-y-4"></div>
  </div>

  <script>
    const priceIds = {
      'Pro Plan': 'price_1SNjljK3D1fY78V90o4deWwj',
      'Growth Plan': 'price_1SNjksK3D1fY78V9S8SrPFFn'
    };

    document.getElementById('checkBtn').addEventListener('click', async () => {
      const stripeKey = document.getElementById('stripeKey').value.trim();
      const resultsDiv = document.getElementById('results');

      if (!stripeKey) {
        resultsDiv.innerHTML = '<div class="bg-red-50 border border-red-200 p-4 rounded">Please enter your Stripe Secret Key</div>';
        return;
      }

      resultsDiv.innerHTML = '<div class="bg-blue-50 border border-blue-200 p-4 rounded">Checking prices...</div>';

      const results = [];

      for (const [planName, priceId] of Object.entries(priceIds)) {
        try {
          const response = await fetch(`https://api.stripe.com/v1/prices/${priceId}?expand[]=product`, {
            headers: {
              'Authorization': `Bearer ${stripeKey}`
            }
          });

          if (response.ok) {
            const price = await response.json();

            const issues = [];
            if (!price.active) issues.push('Price is INACTIVE');
            if (price.type !== 'recurring') issues.push('Price is NOT recurring (must be recurring for subscriptions)');
            if (price.recurring && price.recurring.interval !== 'month') issues.push('Billing interval is not monthly');
            if (!price.product.active) issues.push('Product is INACTIVE');

            results.push({
              name: planName,
              priceId: priceId,
              success: issues.length === 0,
              details: {
                amount: `$${(price.unit_amount / 100).toFixed(2)}`,
                type: price.type,
                interval: price.recurring ? price.recurring.interval : 'N/A',
                priceActive: price.active,
                productActive: price.product.active,
                productName: price.product.name
              },
              issues
            });
          } else {
            const error = await response.json();
            results.push({
              name: planName,
              priceId: priceId,
              success: false,
              error: error.error?.message || 'Unknown error',
              issues: ['Failed to fetch price']
            });
          }
        } catch (error) {
          results.push({
            name: planName,
            priceId: priceId,
            success: false,
            error: error.message,
            issues: ['Network error']
          });
        }
      }

      let html = '';

      for (const result of results) {
        const bgColor = result.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
        const textColor = result.success ? 'text-green-800' : 'text-red-800';
        const icon = result.success ? '✅' : '❌';

        html += `
          <div class="${bgColor} border p-6 rounded-lg">
            <h3 class="font-bold text-lg mb-2">${icon} ${result.name}</h3>
            <p class="text-sm font-mono mb-4">${result.priceId}</p>

            ${result.error ? `
              <div class="mb-4">
                <p class="${textColor} font-semibold">Error:</p>
                <p class="text-sm">${result.error}</p>
              </div>
            ` : ''}

            ${result.details ? `
              <div class="grid grid-cols-2 gap-2 mb-4 text-sm">
                <div><span class="font-semibold">Product:</span> ${result.details.productName}</div>
                <div><span class="font-semibold">Amount:</span> ${result.details.amount}</div>
                <div><span class="font-semibold">Type:</span> ${result.details.type}</div>
                <div><span class="font-semibold">Interval:</span> ${result.details.interval}</div>
                <div><span class="font-semibold">Price Active:</span> ${result.details.priceActive}</div>
                <div><span class="font-semibold">Product Active:</span> ${result.details.productActive}</div>
              </div>
            ` : ''}

            ${result.issues && result.issues.length > 0 ? `
              <div class="${textColor}">
                <p class="font-semibold mb-2">Issues Found:</p>
                <ul class="list-disc ml-6 text-sm space-y-1">
                  ${result.issues.map(issue => `<li>${issue}</li>`).join('')}
                </ul>
              </div>
            ` : `
              <p class="text-green-600 font-semibold">✅ All checks passed! This price is properly configured.</p>
            `}
          </div>
        `;
      }

      resultsDiv.innerHTML = html;
    });
  </script>
</body>
</html>
